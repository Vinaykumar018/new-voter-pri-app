<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SECUP Voter Entry Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== GLOBAL STYLES ===== */
    body {
      background: white;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 14px;
      line-height: 1.4;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    /* ===== SIDEBAR COMPONENT STYLES ===== */
    .sidebar {
      background: white;
      color: black;
      min-height: 100vh;
      padding-top: 15px;
      transition: all 0.3s ease;
      border-right: 1px solid #ddd;
      font-size: 13px;
    }

    .sidebar h5 {
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 15px;
    }

    .sidebar a {
      display: block;
      padding: 10px 12px;
      color: black;
      text-decoration: none;
      margin: 3px 0;
      border-radius: 4px;
      font-size: 13px;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: #e6e9f5;
      color: #1a237e;
    }

    /* ===== HEADER/NAVBAR COMPONENT STYLES ===== */
    .header-bar {
      color: black;
      padding: 8px 15px;
      margin-bottom: 12px;
      font-weight: bold;
      font-size: 13px;
      background-color: #f8f9fa;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    .navbar-custom {
      background: linear-gradient(to right, #3f51b5, #1a237e);
      color: white;
      padding: 8px 15px;
    }

    .navbar-custom .navbar-brand,
    .navbar-custom .nav-link,
    .navbar-custom .navbar-toggler-icon {
      color: white;
      font-size: 15px;
    }

    .navbar-custom .nav-link:hover {
      color: #ffeb3b;
    }

    /* ===== PAGE-SPECIFIC STYLES ===== */
    /* Form Section */
    .form-section {
      border: 1px solid #ccc;
      margin-bottom: 15px;
      border-radius: 4px;
    }

    .form-section .form-header {
      background: #3f51b5;
      color: white;
      padding: 8px 12px;
      font-weight: bold;
      font-size: 14px;
    }

    .form-section .form-body {
      padding: 15px;
      background: white;
    }

    .form-label {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .form-control,
    .form-select {
      font-size: 13px;
      padding: 6px 10px;
      height: 34px;
    }

    .btn {
      font-size: 13px;
      padding: 6px 12px;
    }

    .btn-primary {
      background: #3f51b5;
      border: none;
    }

    .btn-secondary {
      background: #6c757d;
      border: none;
    }

    /* Table Section */
    .table-section {
      border: 1px solid #ccc;
      margin-top: 15px;
      border-radius: 4px;
    }

    .table-section .table-header {
      background: #3f51b5;
      color: white;
      padding: 8px 12px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .table thead th {
      background: #3949ab;
      color: white;
      font-size: 13px;
      padding: 8px 10px;
    }

    .table tbody td {
      font-size: 13px;
      padding: 6px 8px;
      vertical-align: middle;
    }

    .btn-success {
      background: #2e7d32;
      border: none;
    }

    /* Main content transition */
    .main-content {
      transition: all 0.3s ease;
      padding: 10px 15px;
    }

    /* Toggle button styling */
    #toggleSidebar {
      cursor: pointer;
      user-select: none;
      font-size: 15px;
    }

    #toggleSidebar:hover {
      color: #ffeb3b !important;
    }

    /* Radio button styling */
    input[type="radio"] {
      margin-right: 4px;
      vertical-align: middle;
    }

    /* Small text styling */
    .form-text {
      font-size: 12px;
    }

    /* Required field indicator */
    .text-danger {
      color: #dc3545 !important;
      font-weight: bold;
    }

    /* Custom table action buttons */
    .btn-sm {
      padding: 3px 6px;
      font-size: 12px;
    }

    /* Highlight row being edited */
    .editing {
      background-color: #fff8e1 !important;
    }

    /* Toast Notification Styles */
    .toastify {
      padding: 12px 20px;
      color: #fff;
      display: inline-block;
      background: #4caf50;
      position: fixed;
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      max-width: calc(50% - 20px);
      z-index: 2147483647;
      box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);
    }

    .toastify.on {
      opacity: 1;
    }

    .toast-close {
      opacity: 0.4;
      padding: 0 5px;
      position: absolute;
      top: 5px;
      right: 5px;
      background: transparent;
      border: 0;
      color: #fff;
      cursor: pointer;
      font-family: inherit;
      font-size: 1em;
      font-weight: bold;
      line-height: 1;
    }

    .toastify-right {
      right: 15px;
    }

    .toastify-left {
      left: 15px;
    }

    .toastify-top {
      top: 15px;
    }

    .toastify-bottom {
      bottom: 15px;
    }

    .toastify-rounded {
      border-radius: 25px;
    }

    .toastify-avatar {
      width: 1.5em;
      height: 1.5em;
      margin: 0 5px;
      border-radius: 50%;
    }

    .toastify-center {
      margin-left: auto;
      margin-right: auto;
      left: 0;
      right: 0;
      max-width: fit-content;
    }

    @media only screen and (max-width: 360px) {
      .toastify-right, .toastify-left {
        margin-left: auto;
        margin-right: auto;
        left: 0;
        right: 0;
        max-width: fit-content;
      }
    }
    
    /* Validation error styling */
    .is-invalid {
      border-color: #dc3545 !important;
    }
    
    .invalid-feedback {
      display: none;
      width: 100%;
      margin-top: 0.25rem;
      font-size: 0.875em;
      color: #dc3545;
    }
    
    .was-validated .form-control:invalid ~ .invalid-feedback,
    .form-control.is-invalid ~ .invalid-feedback {
      display: block;
    }
  </style>
</head>

<body>
  <!-- ===== HEADER/NAVBAR COMPONENT ===== -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#" id="toggleSidebar">☰ SECUP Voter Entry Tool</a>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <!-- ===== SIDEBAR COMPONENT ===== -->
      <div class="col-md-2 sidebar" id="sidebar">
        <a href="#" data-page="voting" class="active"><i class="fas fa-user-plus me-2"></i>Add Voter</a>
        <a href="#" data-page="sync"><i class="fas fa-sync me-2"></i>Sync With Server</a>
        <a href="#" data-page="update"><i class="fas fa-database me-2"></i>Update Masters</a>
        <a href="#" data-page="view"><i class="fas fa-list me-2"></i>View All</a>
        <a href="#" data-page="home"><i class="fas fa-home me-2"></i>Home</a>
      </div>

      <!-- ===== MAIN CONTENT AREA ===== -->
      <div class="col-md-10 main-content" id="mainContent">
        <!-- Header Bar -->
        <div class="header-bar">
          <span class="text-primary">एक बार में केवल एक ही ग्राम पंचायत मतदाता की प्रविष्टि करें।</span>
          <div class="row mt-2">
            <div class="col-md-4">
              <label class="form-label">Block (ब्लॉक):</label>
              <input type="text" id="blockField" class="form-control" readonly>
            </div>
            <div class="col-md-4">
              <label class="form-label">Gram Panchayat (ग्राम पंचायत):</label>
              <input type="text" id="gpField" class="form-control" readonly>
            </div>
            <div class="col-md-4">
              <label class="form-label">Ward (वार्ड):</label>
              <select id="wardField" class="form-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Add Voter Form -->
        <div class="form-section">
          <div class="form-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Add Voter (मतदाता का विवरण भरे)</h5>
            <p class="mb-0 d-flex align-items-center">
              <span class="text-danger mt-1 me-1" style="font-size: 1.2rem;">*</span>
              <span>Fields Required</span>
            </p>
          </div>
          <div class="form-body">
            <form id="voterForm" class="row g-3" novalidate>
              <input type="hidden" id="editIndex" value="-1">

              <div class="col-md-4">
                <label class="form-label">मकान नंबर <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="houseNumber" required>
                <div class="invalid-feedback">Please enter house number</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">पूरा नाम <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="fullName" required>
                <div class="invalid-feedback">Please enter full name</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">पिता/पति का नाम <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="parentName" required>
                <div class="invalid-feedback">Please enter father/husband name</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">लिंग <span class="text-danger">*</span></label><br>
                <div class="mt-1">
                  <input type="radio" name="gender" value="पुरुष" id="male" required>
                  <label for="male" class="me-3">पुरुष</label>
                  <input type="radio" name="gender" value="महिला" id="female" required>
                  <label for="female">महिला</label>
                </div>
                <div class="invalid-feedback">Please select gender</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">आयु <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="age" min="18" required>
                <small class="form-text text-muted">(18 years and above on 01/01/2020)</small>
                <div class="invalid-feedback">Please enter valid age (18+)</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">जन्म का वर्ष</label>
                <input type="number" class="form-control" id="yearOfBirth" min="1900" max="2020">
                <small class="form-text text-muted">(18 years and above on 01/01/2020)</small>
                <div class="invalid-feedback">Please enter valid birth year</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">मोबाइल नंबर</label>
                <input type="text" class="form-control" id="mobile" maxlength="10" pattern="[0-9]{10}">
                <small class="form-text text-muted">(Ex: 9556668899 — 10 digit only)</small>
                <div class="invalid-feedback">Please enter 10 digit mobile number</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">आधार नंबर <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="aadhaar" maxlength="12" pattern="[0-9]{12}" required>
                <small class="form-text text-muted">(Enter 12 digit Aadhaar number)</small>
                <div class="invalid-feedback">Please enter 12 digit Aadhaar number</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">ई-मेल</label>
                <input type="email" class="form-control" id="email">
                <div class="invalid-feedback">Please enter valid email address</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">मतदान केन्द्र <span class="text-danger">*</span></label>
                <select class="form-select" id="votingCenter" required>
                  <option value="">-- Select --</option>
                  <option value="मतदान केन्द्र 1">मतदान केन्द्र 1</option>
                  <option value="मतदान केन्द्र 2">मतदान केन्द्र 2</option>
                </select>
                <div class="invalid-feedback">Please select voting center</div>
              </div>

              <div class="col-md-4">
                <label class="form-label">मतदान स्थल <span class="text-danger">*</span></label>
                <select class="form-select" id="votingPlace" required>
                  <option value="">-- Select --</option>
                  <option value="मतदान स्थल 1">मतदान स्थल 1</option>
                  <option value="मतदान स्थल 2">मतदान स्थल 2</option>
                </select>
                <div class="invalid-feedback">Please select voting place</div>
              </div>

              <div class="col-12 text-center mt-3">
                <button type="submit" class="btn btn-primary me-2" id="saveBtn">SAVE</button>
                <button type="reset" class="btn btn-secondary" id="resetBtn">RESET</button>
                <button type="button" class="btn btn-warning me-2" id="cancelEditBtn" style="display: none;">CANCEL EDIT</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Voter List Table -->
        <div class="table-section">
          <div class="table-header">
            <span>Voter List (मतदाता सूची)</span>
            <button class="btn btn-success btn-sm" id="exportBtn"><i class="fas fa-file-export me-1"></i>Export to Excel</button>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover mb-0">
              <thead>
                <tr>
                  <th width="100">Action</th>
                  <th>Block</th>
                  <th>Gram Panchayat</th>
                  <th>Ward</th>
                  <th>House No.</th>
                  <th>Name</th>
                  <th>Father/Husband</th>
                  <th>Gender</th>
                  <th>Age</th>
                  <th>Email</th>
                  <th>UID</th>
                  <th>Contact No.</th>
                  <th>YearOfBirth</th>
                  <th>PS Name</th>
                </tr>
              </thead>
              <tbody id="voterTableBody">
                <!-- Table rows will be added dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    const { ipcRenderer } = require('electron');
    // Toastify implementation (self-contained)
    function Toastify(options) {
      // Initialization
      const toast = document.createElement('div');
      toast.className = 'toastify on';
      
      // Positioning
      toast.className += ' toastify-' + (options.position || 'right');
      toast.className += ' toastify-' + (options.gravity || 'top');
      
      if (options.avatar) {
        const avatarImg = document.createElement('img');
        avatarImg.src = options.avatar;
        avatarImg.className = 'toastify-avatar';
        toast.appendChild(avatarImg);
      }
      
      // Text
      toast.innerHTML += options.text || '';
      
      // Close button
      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '&times;';
      closeBtn.className = 'toast-close';
      closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        removeToast(toast);
      });
      toast.appendChild(closeBtn);
      
      // Additional classes
      if (options.className) {
        toast.className += ' ' + options.className;
      }
      
      // Duration
      if (options.duration > 0) {
        setTimeout(function() {
          removeToast(toast);
        }, options.duration);
      }
      
      // Click callback
      if (typeof options.onClick === 'function') {
        toast.addEventListener('click', options.onClick);
      }
      
      // Add to DOM
      document.body.appendChild(toast);
      
      // Animation
      setTimeout(function() {
        toast.classList.add('on');
      }, 10);
      
      function removeToast(toastElement) {
        toastElement.classList.remove('on');
        setTimeout(function() {
          if (toastElement.parentNode) {
            toastElement.parentNode.removeChild(toastElement);
          }
        }, 400);
      }
      
      return {
        hideToast: function() {
          removeToast(toast);
        }
      };
    }

    // Store voter data
    let voters = [];
    let currentEditIndex = -1;
    let blockData = "";
    let gpData = "";
    let wardData = "";

    // Listen for data from Electron main process
ipcRenderer.on('set-all-data', (event, data) => {
  console.log('Received all data:', data);

  // Fill Block and Gram Panchayat dynamically
  document.getElementById('blockField').value = data.block?.name || "";
  document.getElementById('gpField').value = data.gramPanchayat?.name || "";

  // Store the data for later use
  const blockData = data.block?.name || "";
  const gpData = data.gramPanchayat?.name || "";

  // Show notification (if element exists)
  const notification = document.getElementById('demoNotification');
  if (notification) {
    notification.style.display = 'block';
    setTimeout(() => {
      notification.style.display = 'none';
    }, 3000);
  }
});

// Initialize the page
document.addEventListener('DOMContentLoaded', function () {
  // Load any existing data from localStorage
  loadVotersFromStorage();

  // Set up event listeners
  document.getElementById('voterForm').addEventListener('submit', handleFormSubmit);
  document.getElementById('resetBtn').addEventListener('click', resetForm);
  document.getElementById('cancelEditBtn').addEventListener('click', cancelEdit);
  document.getElementById('exportBtn').addEventListener('click', exportToExcel);

  // Add input validation
  setupFormValidation();

  // Request data on refresh
  if (typeof ipcRenderer !== 'undefined') {
    ipcRenderer.send('request-data-on-refresh', 'voting'); // ask main for latest data
  }

  // Render the table
  renderVoterTable();
});



     window.addEventListener('load', () => {
      ipcRenderer.send('request-data-on-refresh', 'voting');
    });

    // Setup form validation
    function setupFormValidation() {
      const form = document.getElementById('voterForm');
      
      // Add input event listeners for real-time validation
      const inputs = form.querySelectorAll('input, select');
      inputs.forEach(input => {
        input.addEventListener('input', function() {
          if (input.checkValidity()) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
          } else {
            input.classList.remove('is-valid');
          }
        });
        
        input.addEventListener('blur', function() {
          if (!input.checkValidity()) {
            input.classList.add('is-invalid');
          }
        });
      });
    }

    // Show Toast notification
    function showToast(message, type = 'success') {
      Toastify({
        text: message,
        duration: 3000,
        gravity: "top",
        position: "right",
        className: type === 'success' ? '' : 'bg-danger'
      });
    }

    // Handle incoming data (from Electron or demo)
    function handleIncomingData(data) {
      console.log('Received data:', data);

      // Fill Block and Gram Panchayat dynamically
      document.getElementById('blockField').value = data.block?.name || "";
      document.getElementById('gpField').value = data.gramPanchayat?.name || "";
      
      // Set ward if provided
      if (data.ward) {
        document.getElementById('wardField').value = data.ward;
      }

      // Store the data for later use
      blockData = data.block?.name || "";
      gpData = data.gramPanchayat?.name || "";
      wardData = document.getElementById('wardField').value;

      // Show notification
      showToast('Location data loaded successfully!');
    }

    // Handle form submission
    function handleFormSubmit(e) {
      e.preventDefault();
      
      const form = e.target;
      
      // Validate form
      if (!form.checkValidity()) {
        e.stopPropagation();
        form.classList.add('was-validated');
        
        // Show validation errors
        const firstInvalid = form.querySelector(':invalid');
        if (firstInvalid) {
          firstInvalid.focus();
        }
        
        showToast('Please fill all required fields correctly', 'error');
        return;
      }

      // Get form values
      const voter = {
        houseNumber: document.getElementById('houseNumber').value,
        fullName: document.getElementById('fullName').value,
        parentName: document.getElementById('parentName').value,
        gender: document.querySelector('input[name="gender"]:checked').value,
        age: document.getElementById('age').value,
        yearOfBirth: document.getElementById('yearOfBirth').value || calculateYearOfBirth(document.getElementById('age').value),
        mobile: document.getElementById('mobile').value,
        aadhaar: document.getElementById('aadhaar').value,
        email: document.getElementById('email').value,
        votingCenter: document.getElementById('votingCenter').value,
        votingPlace: document.getElementById('votingPlace').value,
        block: blockData,
        gramPanchayat: gpData,
        ward: document.getElementById('wardField').value
      };

      // Check if we're editing or adding new
      const editIndex = parseInt(document.getElementById('editIndex').value);

      if (editIndex >= 0) {
        // Update existing voter - preserve original block and gramPanchayat
        voters[editIndex] = {
          ...voters[editIndex], // Keep original values
          ...voter, // Update with new values
          block: voters[editIndex].block, // Keep original block
          gramPanchayat: voters[editIndex].gramPanchayat // Keep original gramPanchayat
        };
        
        currentEditIndex = -1;
        document.getElementById('editIndex').value = '-1';
        document.getElementById('cancelEditBtn').style.display = 'none';
        document.getElementById('saveBtn').textContent = 'SAVE';
        
        showToast('Voter updated successfully!');
      } else {
        // Add new voter
        voters.push(voter);
        showToast('New voter added successfully!');
      }

      // Save to localStorage and update UI
      saveVotersToStorage();
      renderVoterTable();
      resetForm();
    }
    
    // Calculate year of birth based on age
    function calculateYearOfBirth(age) {
      const currentYear = new Date().getFullYear();
      return (currentYear - parseInt(age)).toString();
    }

    // Edit voter function
    function editVoter(index) {
      const voter = voters[index];

      // Fill form with voter data
      document.getElementById('houseNumber').value = voter.houseNumber;
      document.getElementById('fullName').value = voter.fullName;
      document.getElementById('parentName').value = voter.parentName;

      // Set gender radio button
      document.querySelectorAll('input[name="gender"]').forEach(radio => {
        radio.checked = (radio.value === voter.gender);
      });

      document.getElementById('age').value = voter.age;
      document.getElementById('yearOfBirth').value = voter.yearOfBirth || '';
      document.getElementById('mobile').value = voter.mobile;
      document.getElementById('aadhaar').value = voter.aadhaar;
      document.getElementById('email').value = voter.email;
      document.getElementById('votingCenter').value = voter.votingCenter;
      document.getElementById('votingPlace').value = voter.votingPlace;
      
      // Set ward (can be edited)
      document.getElementById('wardField').value = voter.ward;

      // Set edit mode
      document.getElementById('editIndex').value = index;
      currentEditIndex = index;
      document.getElementById('cancelEditBtn').style.display = 'inline-block';
      document.getElementById('saveBtn').textContent = 'UPDATE';

      // Highlight the row being edited
      const rows = document.querySelectorAll('#voterTableBody tr');
      rows.forEach((row, i) => {
        if (i === index) {
          row.classList.add('editing');
        } else {
          row.classList.remove('editing');
        }
      });

      // Scroll to form
      document.getElementById('voterForm').scrollIntoView({ behavior: 'smooth' });
      
      showToast('Editing voter details');
    }

    // Delete voter function
    function deleteVoter(index) {
      if (confirm('Are you sure you want to delete this voter?')) {
        const deletedVoter = voters[index];
        voters.splice(index, 1);
        saveVotersToStorage();
        renderVoterTable();
        
        // If we were editing this voter, cancel edit mode
        if (currentEditIndex === index) {
          cancelEdit();
        }
        
        showToast(`Voter ${deletedVoter.fullName} deleted`);
      }
    }

    // Cancel edit mode
    function cancelEdit() {
      resetForm();
      currentEditIndex = -1;
      document.getElementById('editIndex').value = '-1';
      document.getElementById('cancelEditBtn').style.display = 'none';
      document.getElementById('saveBtn').textContent = 'SAVE';

      // Remove editing highlight
      const rows = document.querySelectorAll('#voterTableBody tr');
      rows.forEach(row => row.classList.remove('editing'));
      
      showToast('Edit cancelled');
    }

    // Reset form
    function resetForm() {
      document.getElementById('voterForm').reset();
      document.getElementById('voterForm').classList.remove('was-validated');
      
      // Clear validation states
      const inputs = document.querySelectorAll('.is-invalid, .is-valid');
      inputs.forEach(input => {
        input.classList.remove('is-invalid');
        input.classList.remove('is-valid');
      });
    }

    // Render voter table
    function renderVoterTable() {
      const tableBody = document.getElementById('voterTableBody');
      tableBody.innerHTML = '';

      if (voters.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="14" class="text-center">No voters added yet</td>`;
        tableBody.appendChild(row);
        return;
      }

      voters.forEach((voter, index) => {
        const row = document.createElement('tr');
        if (index === currentEditIndex) {
          row.classList.add('editing');
        }

        row.innerHTML = `
          <td>
            <button class="btn btn-sm btn-primary" onclick="editVoter(${index})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteVoter(${index})">Delete</button>
          </td>
          <td>${voter.block}</td>
          <td>${voter.gramPanchayat}</td>
          <td>${voter.ward}</td>
          <td>${voter.houseNumber}</td>
          <td>${voter.fullName}</td>
          <td>${voter.parentName}</td>
          <td>${voter.gender}</td>
          <td>${voter.age}</td>
          <td>${voter.email}</td>
          <td>${voter.aadhaar}</td>
          <td>${voter.mobile}</td>
          <td>${voter.yearOfBirth}</td>
          <td>${voter.votingPlace}</td>
        `;

        tableBody.appendChild(row);
      });
    }

    // Save voters to localStorage
    function saveVotersToStorage() {
      localStorage.setItem('voters', JSON.stringify(voters));
    }

    // Load voters from localStorage
    function loadVotersFromStorage() {
      const storedVoters = localStorage.getItem('voters');
      if (storedVoters) {
        voters = JSON.parse(storedVoters);
        showToast('Previous data loaded from storage');
      }
    }

    // Export to Excel function
    function exportToExcel() {
      if (voters.length === 0) {
        showToast('No data to export', 'error');
        return;
      }
      
      const csv = [];
      // Add headers
      csv.push(['Block', 'Gram Panchayat', 'Ward', 'House No.', 'Name', 'Father/Husband', 'Gender', 'Age', 'Email', 'UID', 'Contact No.', 'YearOfBirth', 'PS Name']);

      // Add data rows
      voters.forEach(voter => {
        csv.push([
          voter.block,
          voter.gramPanchayat,
          voter.ward,
          voter.houseNumber,
          voter.fullName,
          voter.parentName,
          voter.gender,
          voter.age,
          voter.email,
          voter.aadhaar,
          voter.mobile,
          voter.yearOfBirth,
          voter.votingPlace
        ]);
      });

      // Create CSV content
      const csvContent = "data:text/csv;charset=utf-8," + csv.map(row => row.join(',')).join('\n');

      // Create download link
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', 'voter_list.csv');
      document.body.appendChild(link);

      // Trigger download
      link.click();
      document.body.removeChild(link);
      
      showToast('Data exported to CSV file');
    }

    // ===== SIDEBAR TOGGLE FUNCTIONALITY =====
    const toggleBtn = document.getElementById('toggleSidebar');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');

    toggleBtn.addEventListener('click', (e) => {
      e.preventDefault();

      // Toggle sidebar visibility
      sidebar.classList.toggle('d-none');

      // Toggle main content width
      if (sidebar.classList.contains('d-none')) {
        // When sidebar is hidden, make main content full width
        mainContent.classList.remove('col-md-10');
        mainContent.classList.add('col-12');
      } else {
        // When sidebar is visible, restore original width
        mainContent.classList.remove('col-12');
        mainContent.classList.add('col-md-10');
      }
    });

    // ===== NAVIGATION FUNCTIONALITY =====
    document.querySelectorAll('.sidebar a').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        // For demo purposes, we'll just log the navigation
        console.log('Navigating to:', link.getAttribute('data-page'));
        // In a real Electron app, you would use ipcRenderer here
        // ipcRenderer.send('navigate-to', link.getAttribute('data-page'));
      });
    });

    // Handle Electron IPC communication if available
    if (typeof ipcRenderer !== 'undefined') {
      // Listen for data from Electron main process
      ipcRenderer.on('set-all-data', (event, data) => {
        handleIncomingData(data);
      });

      window.addEventListener('load', () => {
        ipcRenderer.send('request-data-on-refresh', 'voting');
      });
    }
  </script>
</body>

</html>