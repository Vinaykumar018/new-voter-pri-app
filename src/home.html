<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <style>
    /* ===== GLOBAL STYLES ===== */
    body {
      background: white;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 14px;
      line-height: 1.4;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    /* ===== SIDEBAR COMPONENT STYLES ===== */
    .sidebar {
      background: white;
      color: black;
      min-height: 100vh;
      padding-top: 15px;
      transition: all 0.3s ease;
      border-right: 1px solid #ddd;
      font-size: 13px;
    }

    .sidebar h5 {
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 15px;
    }

    .sidebar a {
      display: block;
      padding: 10px 12px;
      color: black;
      text-decoration: none;
      margin: 3px 0;
      border-radius: 4px;
      font-size: 13px;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: #e6e9f5;
      color: #1a237e;
    }

    /* ===== HEADER/NAVBAR COMPONENT STYLES ===== */
    .header-bar {
      color: black;
      padding: 8px 15px;
      margin-bottom: 12px;
      font-weight: bold;
      font-size: 13px;
      background-color: #f8f9fa;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    .navbar-custom {
      background: linear-gradient(to right, #3f51b5, #1a237e);
      color: white;
      padding: 8px 15px;
    }

    .navbar-custom .navbar-brand,
    .navbar-custom .nav-link,
    .navbar-custom .navbar-toggler-icon {
      color: white;
      font-size: 15px;
    }

    .navbar-custom .nav-link:hover {
      color: #ffeb3b;
    }

    /* Loading indicator */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- ===== HEADER/NAVBAR COMPONENT ===== -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#" id="toggleSidebar">â˜° SECUP Voter Entry Tool</a>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <!-- ===== SIDEBAR COMPONENT ===== -->
      <div class="col-md-2 sidebar" id="sidebar">
        <a href="#" data-page="voting"><i class="fas fa-user-plus me-2"></i>Add Voter</a>
        <a href="#" data-page="sync"><i class="fas fa-sync me-2"></i>Sync With Server</a>
        <a href="#" data-page="update"><i class="fas fa-database me-2"></i>Update Masters</a>
        <a href="#" data-page="view"><i class="fas fa-list me-2"></i>View All</a>
        <a href="#" data-page="home" class="active"><i class="fas fa-home me-2"></i>Home</a>
      </div>

      <!-- ===== MAIN CONTENT AREA ===== -->
      <div class="col-md-10 p-4 main-content" id="mainContent">
        <!-- Welcome Header -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="p-4 rounded" style="background: linear-gradient(to right, #3f51b5, #1a237e); color: white;">
              <h2 class="mb-1"><i class="fas fa-vote-yea me-2"></i>Welcome to SECUP Voter Entry Tool</h2>
              <p class="mb-0">Efficient voter data management system for election officials</p>
            </div>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4">
          <div class="col-md-3 mb-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body text-center">
                <div class="text-primary mb-2">
                  <i class="fas fa-users fa-2x"></i>
                </div>
                <h3 class="card-title" id="totalVoters">Loading...</h3>
                <p class="card-text">Total Voters Registered</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body text-center">
                <div class="text-success mb-2">
                  <i class="fas fa-cloud-upload-alt fa-2x"></i>
                </div>
                <h3 class="card-title" id="syncedVoters">Loading...</h3>
                <p class="card-text">Synced with Server</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body text-center">
                <div class="text-warning mb-2">
                  <i class="fas fa-clock fa-2x"></i>
                </div>
                <h3 class="card-title" id="pendingVoters">Loading...</h3>
                <p class="card-text">Pending Sync</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="card h-100 shadow-sm">
              <div class="card-body text-center">
                <div class="text-info mb-2">
                  <i class="fas fa-map-marker-alt fa-2x"></i>
                </div>
                <h3 class="card-title">3</h3>
                <p class="card-text">Polling Stations</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
              </div>
              <div class="card-body">
                <div class="row text-center">
                  <div class="col-md-3 mb-3">
                    <a href="#" data-page="voting" class="btn btn-outline-primary btn-lg p-3 w-100">
                      <i class="fas fa-user-plus fa-2x mb-2"></i>
                      <br>
                      Add New Voter
                    </a>
                  </div>
                  <div class="col-md-3 mb-3">
                    <a href="#" data-page="view" class="btn btn-outline-success btn-lg p-3 w-100">
                      <i class="fas fa-list fa-2x mb-2"></i>
                      <br>
                      View All Voters
                    </a>
                  </div>
                  <div class="col-md-3 mb-3">
                    <a href="#" data-page="sync" class="btn btn-outline-info btn-lg p-3 w-100">
                      <i class="fas fa-sync fa-2x mb-2"></i>
                      <br>
                      Sync Data
                    </a>
                  </div>
                  <div class="col-md-3 mb-3">
                    <a href="#" data-page="update" class="btn btn-outline-warning btn-lg p-3 w-100">
                      <i class="fas fa-database fa-2x mb-2"></i>
                      <br>
                      Update Masters
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Global variables
    let navigationData = {};
    let totalVoters = 0;
    let syncedVoters = 0;
    let pendingVoters = 0;

    // ===== SIDEBAR TOGGLE FUNCTIONALITY =====
    const toggleBtn = document.getElementById('toggleSidebar');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');

    toggleBtn.addEventListener('click', (e) => {
      e.preventDefault();

      // Toggle sidebar visibility
      sidebar.classList.toggle('d-none');

      // Toggle main content width
      if (sidebar.classList.contains('d-none')) {
        // When sidebar is hidden, make main content full width
        mainContent.classList.remove('col-md-10');
        mainContent.classList.add('col-12');
      } else {
        // When sidebar is visible, restore original width
        mainContent.classList.remove('col-12');
        mainContent.classList.add('col-md-10');
      }
    });

    // ===== NAVIGATION FUNCTIONALITY =====
    function setupNavigation() {
      document.querySelectorAll('[data-page]').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const page = link.getAttribute('data-page');
          
          // Update active state in sidebar
          document.querySelectorAll('.sidebar a').forEach(item => {
            item.classList.remove('active');
          });
          link.classList.add('active');
          
          // In a real app, you would handle page navigation here
          console.log(`Navigating to ${page} page...`);
          
          // If we're in Electron, use IPC
          if (typeof require !== 'undefined') {
            const { ipcRenderer } = require('electron');
            ipcRenderer.send('navigate-to', page);
          }
        });
      });
    }

    // ===== VOTER COUNT FUNCTIONALITY =====
    async function fetchVoterCounts() {
      try {
        // Fetch data from API
        const response = await fetch('https://demo.deifichrservices.com/api/get-all-voter');
        const apiData = await response.json();
        
        // Get data from local storage
        const localVoters = JSON.parse(localStorage.getItem('voters') || '[]');
        
        // Calculate counts
        
        syncedVoters = apiData.data.length || 0;
        pendingVoters = localVoters.length || 0;
        totalVoters = syncedVoters + pendingVoters;
        
        // Update the UI
        document.getElementById('totalVoters').textContent = totalVoters.toLocaleString();
        document.getElementById('syncedVoters').textContent = syncedVoters.toLocaleString();
        document.getElementById('pendingVoters').textContent = pendingVoters.toLocaleString();
        
      } catch (error) {
        console.error('Error fetching voter data:', error);
        
        // Fallback to local storage only if API fails
        const localVoters = JSON.parse(localStorage.getItem('voters') || '[]');
        pendingVoters = localVoters.length || 0;
        totalVoters = pendingVoters;
        
        document.getElementById('totalVoters').textContent = totalVoters.toLocaleString();
        document.getElementById('syncedVoters').textContent = 'Error';
        document.getElementById('pendingVoters').textContent = pendingVoters.toLocaleString();
      }
    }

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
      setupNavigation();
      fetchVoterCounts();
      
      // Set up query parameter listener for routing
      if (typeof URLSearchParams !== 'undefined') {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        
        if (page) {
          // Find and click the corresponding navigation link
          const navLink = document.querySelector(`[data-page="${page}"]`);
          if (navLink) {
            navLink.click();
          }
        }
      }
    });

    // ===== ELECTRON SPECIFIC CODE =====
    if (typeof require !== 'undefined') {
      const { ipcRenderer } = require('electron');
      
      ipcRenderer.on('set-all-data', (event, data) => {
        navigationData = data;
        console.log('Received all data:', data);
      });
      
      window.addEventListener('load', () => {
        ipcRenderer.send('request-data-on-refresh', 'voting');
      });
    }
  </script>
</body>
</html>